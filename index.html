<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>gtm2-youtube-event-tracking by grantmarch</title>
    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/github-dark.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script src="javascripts/respond.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <!--[if lt IE 8]>
    <link rel="stylesheet" href="stylesheets/ie.css">
    <![endif]-->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

  </head>
  <body>
      <div id="header">
        <nav>
          <li class="fork"><a href="https://github.com/grantmarch/gtm2-youtube-event-tracking">View On GitHub</a></li>
          <li class="downloads"><a href="https://github.com/grantmarch/gtm2-youtube-event-tracking/zipball/master">ZIP</a></li>
          <li class="downloads"><a href="https://github.com/grantmarch/gtm2-youtube-event-tracking/tarball/master">TAR</a></li>
          <li class="title">DOWNLOADS</li>
        </nav>
      </div><!-- end header -->

    <div class="wrapper">

      <section>
        <div id="title">
          <h1>gtm2-youtube-event-tracking</h1>
          <p>YouTube Event Tracking in Google Analytics for non-developers</p>
          <hr>
          <span class="credits left">Project maintained by <a href="https://github.com/grantmarch">grantmarch</a></span>
          <span class="credits right">Hosted on GitHub Pages &mdash; Theme by <a href="https://twitter.com/michigangraham">mattgraham</a></span>
        </div>

<h3>
<a id="target-audience" class="anchor" href="#target-audience" aria-hidden="true"><span class="octicon octicon-link"></span></a>Target Audience</h3>

<p>This tutorial is primarily aimed at non developers and describes how the code can be used in Google Tag Manager to generate YouTube events for Google Analytics (GA). A developer is required, however, to enable pages for Google Tag Manager (GTM). This can be done instead of enabling pages for GA. Developer details are included for completeness.</p>

<h3>
<a id="Goal" class="anchor" href="#Goal" aria-hidden="true"><span class="octicon octicon-link"></span></a>Goal</h3>

<p>Here is a 1:10 minute video showing the goal of being able log YouTube events, eg. play, pause, in Google Analytics.</p>

<iframe width="560" height="315" src="https://www.youtube.com/embed/iPVK8WdKCsg" frameborder="0" allowfullscreen></iframe>

<h3>
<a id="Overview" class="anchor" href="#overview" aria-hidden="true"><span class="octicon octicon-link"></span></a>Overview</h3>

<h4>Google Analytics</h4>
<p>
A small bit of Javascript can be placed on a page to allow Google Analytics (GA) (<a href="http://www.google.ie/analytics">www.google.ie/analytics</a>) to track the page. We will only be using the Tracking Id from this code here.
</p>

<h4>Google Tag Manager</h4>
<p>
Google have created Google Tag Manager (GTM) (<a href="http://www.google.com/tagmanager">www.google.com/tagmanager</a>) as an accompaniment to GA which allows non developers to be better able control what GA monitors without having to continuously request assistance from a developer. A small piece of Javascript code must be added to each page using GTM just as you would do for Google Analytics.
</p>

<p>
This tutorial specifically focuses on monitoring the YouTube video events ENDED, PLAYING, PAUSED, BUFFERING, CUED. But it is obviously possible to monitor other non YouTube events too, for example it is possible to monitor clicks on tabs on a page that load ajax content onto the same page. 
</p>

<h4>Custom Javascript</h4>
<p>
In addition to the GTM code above, a non-developer can add some custom code (by just cutting and pasting) that enables the page to "listen" for YouTube events. This code then passes the events to a concept called the "data layer". GTM manager can "read" these events in the data layer and, in turn, pass them on to GA to monitor. This code has been tested with Chrome. Please report how it works for other browsers - some changes may be necessary.
</p>

<h4>Google Developer's Console</h4>
<p>
We will also use the Google Developer's Console (<a href="http://console.developers.google.com">console.developers.google.com</a>). This is not required for our event tracking as Youtube videos are tracked by their video id, eg. <a hef="https://www.youtube.com/watch?v=_AhXOcM8Liw">https://www.youtube.com/watch?v=_AhXOcM8Liw</a>. If you click the Youtube link, you'll see that the title of this video is "Cliffs of Moher". 
</p>

<p>
We can use some of Google's Youtube Data API v3 to get the title corresponding to this video id. This means that the resulting events can be recorded in GA using the more meaningful title as opposed to the obscure video id. For security and monitoring purposes we have to request access to Google's APIs and we do this using the Google Developer's Console. This is the main functionality I've added here to code by Lunametrics (<a href="https://github.com/lunametrics/youtube-google-analytics" class="user-mention">@lunametrics</a>)
</p>

<h4>Developer vs non developer</h4>
<p>
If a Youtube video is to be embedded on a page, the web developer will be doing that anyway.
The GTM code has to be put on pages to monitor events (and more) instead of the GA code.
After that, a non developer has considerable scope to set up events in GTM for GA to monitor.</p>

<h3>
<a id="developer-required-tasks" class="anchor" href="#developer-required-tasks" aria-hidden="true"><span class="octicon octicon-link"></span></a>Developer Required Tasks</h3>

<h4>Finding Embed Code for YouTube Video</h4>

<p>Looking at the previous Youtube video of the Cliffs of Moher, click Share &gt; Embed and cut and paste the provided code into your web page.</p>

<img src="./sc-images/010-youtube-embed-code.png">

<h4>Web Page with Two Embedded YouTube Videos</h4>

<img src="./sc-images/020-web-page-with-2-videos.png">

<h4>Enable GTM on this Page</h4>

<p>We need to get the GTM code to put on the web page. It is suggested developers should do this as a matter of course - just as they would have done for the GA code fragment they will have used before</p>

<h4>Create GTM Account and a Container</h4>

<p>Login to <a href="http://www.google.ie/tagmanager">www.google.ie/tagmanager</a> and create an account. A container is used to hold one website domain that you are managing.</p>

<img src="./sc-images/030-GTM-account.png">

<h4>Add GTM Javascript Code to your Web Page</h4>

<p>You will be directed to the GTM Javascript snippet that has to be added to your web page.</p>

<img src="./sc-images/040-GTM-code-snippet.png">

<p>Your web page should now look something like this</p>

<img src="./sc-images/050-page-with-GTM.png">

<h4>The GTM Dashboard</h4>

<p>The GTM should be displaying its dashboard. Note that you are "in" the Container tab and you have the container you defined earlier, namely - www.&lt;somewebsite&gt;.com.</p>

<img src="./sc-images/060-GTM-dashboard.png">

<h4>Finding your GTM Code Snippet Again</h4>

<p>If you need to find the GTM code again, to add to a different page for example, go to Admin &gt; Install Google Tag Manager. This doesn't actually "install" anything - it just shows you the GTM Javascript code again.</p>

<img src="./sc-images/070-GTM-code-again.png">

<h3>
<a id="non-developer-tasks" class="anchor" href="#non-developer-tasks" aria-hidden="true"><span class="octicon octicon-link"></span></a>Non Developer Tasks</h3>

<h4>GTM Dashboard Again</h4>

<p>
In GTM we will primarily use 3 concepts - Variables, Triggers and Tags.
</p>

<p>
Consider Variables to be containers that can hold a value. 
Triggers send out a message that other parts of GTM can act upon. 
Tags (nothing to do with HTML tags) are units that carry out specific functionality. This will become more clear as this example is developed.
</p>

<h4>Non Developer Task Summary</h4>

<p>At this stage, our developers should have set up the page with YouTube videos to be able to "talk" to GTM. Now a non-developer can decide which pages should be monitored for YouTube events. This is a summary of the process involved.</p>

<ol>
	<li>Get YouTube API key</li>
	<li>Create a variable in GTM, YouTubeApiKeyVar, to hold our api key for the YouTube Data v3 api. This variable is used by our custom Javascript
	which we will add later. This allows our Javascript to use the YouTube Data API v3 to get the video titles corresponding to video ids.</li>
	<li>Get GA Tracking Id</li>
	<li>Create a variable, GATrackingIdVar, which holds the Google Analytics Tracking Id which is got from our GA account. This allows GTM to send
	    event data to GA. Although we've "enabled" GTM in our web page, we still need to send events from our web page to GTM (which then sends
			them on to GA). These events are generated by some custom Javascript that a non-developer can "insert" into our page using GTM.</li>
	<li>"Insert" our own Javascript YouTube event tracking code (in a GTM tag which I will call GAYouTubeJSTag ) to monitor all the YouTube
	    videos on the page.
			When the custom Javascript "hears" an event, it sends a message to (what is called) the Data Layer. The message for the video playing
			looks like this... { 'event': 'youtube-event', 'action': 'video-playing', 'label': 'none' } ...  GTM has access to the Data Layer and
			can "see" these 3 items that make up an event. To make them usable in GTM we have to "reference" them with a GTM variable.</li>
	<li>Checking your GTM set up so far</li>
	<li>We will create a Trigger, YouTubeEventTrig, that is fired when a youtube-event occurs.</li>
	<li>We will create a Variable, YouTubeActionVar, that reads the data layer and gets the action</li>
	<li>We will create a Variable, called YouTubeLabelVar, that reads the data layer and gets the label.</li>
	<li>Now that everything is set up, we can create a tag, YouTubeTag, that glues all these elements together and sends the event info off to
			GA where the events can be analysed in real time and also collated over time.</li>
	<li>Remember to PUBLISH your changes.</li>
</ol>

<h3>
<a id="get-youtube-api-key" class="anchor" href="#get-youtube-api-key" aria-hidden="true"><span class="octicon octicon-link"></span></a>Get YouTube API Key</h3>

<p>Go to <a href="http://console.developers.google.com">console.developers.google.com</a> and Create Project.
Now we can use some of the many Google APIs that are available to control and manipulate Google Products. In our case, we just want to use the YouTube Data API v3. Click on APIs and Auth > APIs and enter YouTube in search box and click on YouTube Data API v3.
</p>

<p>
In the resulting screen click "Enable API" (not shown here). Before we can use the YouTube Data API v3 we have to generate some credentials to allow us access to the API. 
</p>

<p>
Google allows 2 kinds of access. If you are just requesting read only access to public data then you only require Public API Access. This is what we will be using. The titles and video id for any YouTube video are in the public domain. Otherwise Google's implementation of OAuth can be used to get permission from the user before accessing their private data.
</p>

<p>
But even with Public API Access, you might be wondering why Google goes to all this bother for us to access data that is in the public domain. One reason, I'm sure there are others, is that every user of Google's APIs is subject to a certain limit on the number of accesses that can be made to an API over a particular course of time.
</p>

<p>
Now we can create the API key which our Javascript code can use to allow us access to the YouTube Data API v3. Click Create new Key.
</p>

<img src="sc-images/110-create-key.png">

<img src="sc-images/120-browser-key.png">

<p>
We are then asked what websites we should allow to use our API key. Enter your website in the following form...  *.somewebsite.com
</p>

<img src="sc-images/130-referrers-key.png">

<p>
Now make a note of your API key. We can always come back to the Google Developers Console if we need to look it up at a later stage.
</p>

<img src="sc-images/140-api-key.png">

<p>
We are now ready to start working with GTM.
</p>

<h3>
<a id="create-youtube-apikeyvar" class="anchor" href="#create-youtube-apikeyvar" aria-hidden="true"><span class="octicon octicon-link"></span></a>Create YouTubeApiKeyVar</h3>

<p>
Click Variables. There are a number of pre-defined variables that you can enable/disable. Just use the default settings for all of these. But we want to create new User-Defined variable for our api key for YouTube  Data Api v3.
</p>

<img src="sc-images/160-var-for-apikey.png">

<p>
Give your variable a name, here I've used YouTubeApiKeyVar. Our Api key is not going to change, so we will use the Constant variable type. Click Continue.
</p>

<img src="sc-images/170-var-for-apikey-choose-type.png">

<p>
Now cut and paste in your api key from the Google Developer's Console and Create the variable.
</p>

<img src="sc-images/180-var-for-apikey-config-var.png">

<h3>
<a id="get-ga-tracking-id" class="anchor" href="#get-ga-tracking-id" aria-hidden="true"><span class="octicon octicon-link"></span></a>Get GA Tracking  Id</h3>

<p>
To be able to monitor our events with GA we have to connect GTM with GA using our GA tracking id. We will do this later. In the meantime to make things easy for us, go ahead and create another constant variable called GATrackingIdVar. Now we won't have to go routing around GA for this id whenever we need to use it in GTM.
</p>

<p>
To remind you, here's how we access the tracking number in GA. Open <a href="http://www.google.ie/analytics">www.google.ie/analytics</a> in your browser. Admin &gt; Tracking Info &gt; Tracking Code
</p>

<img src="sc-images/190-tracking-info.png">

<img src="sc-images/200-tracking-id.png">

<h3>
<a id="create-gatrackingidvar" class="anchor" href="#create-gatrackingidvar" aria-hidden="true"><span class="octicon octicon-link"></span></a>Create GATrackingIdVar</h3>

<p>
You should now have 2 User-Defined variables.
</p>

<img src="sc-images/210-user-defined-vars.png">

<h3>
<a id="insert-youtube-tracking-javascript-using-gayoutubejstag" class="anchor" href="#insert-youtube-tracking-javascript-using-gayoutubejstag" aria-hidden="true"><span class="octicon octicon-link"></span></a>"Insert" YouTube Tracking Javascript Using GAYouTubeJSTag</h3>

<p>
Tags &gt; New &gt; Custom HTML Tag (look for it!) &gt; Continue &gt; Configure Tag (cut the Javascript from here and paste in the HTML box)
</p>

<img src="sc-images/220-GAYouTubeJSTag.png">

<p>
** Purists will note that the Javascript is surrounded by &lt;script&gt;&lt;/script&gt; - so the pasted code is really a HTML script tag with Javascript inside it **
</p>

<p>
Finally we tell GTM which pages on our website we would like to have this Javascript inserted. For now let's just say we want it on every page. GTM uses the terminology to "fire" this Javascript on all pages. Save your tag.
</p>

<img src="sc-images/230-fire-all-pages.png">

<h3>
<a id="checking-your-gtm-set-up-so-far" class="anchor" href="#checking-your-gtm-set-up-so-far" aria-hidden="true"><span class="octicon octicon-link"></span></a>Checking Your GTM Set Up So Far</h3>

<p>
These changes that we've made in GTM are not "live". We have to "Publish" them for this to be the case. When changes are published GTM checks what you've done and will highlight any errors it may encounter. Publish your changes from time to time to catch any errors. Do so now.
</p>

<img src="sc-images/240-publish.png">

<h3>
<a id="create-youtubeeventtrig-trigger" class="anchor" href="#create-youtubeeventtrig-trigger" aria-hidden="true"><span class="octicon octicon-link"></span></a>Create YouTubeEventTrig trigger</h3>

<p>
Triggers &gt; New
</p>

<img src="sc-images/250-youtube-event-trig.png">

<h3>
<a id="create-youtubeactionvar-data-layer-variable" class="anchor" href="#create-youtubeactionvar-data-layer-variable" aria-hidden="true"><span class="octicon octicon-link"></span></a>Create YouTubeActionVar Data Layer Variable</h3>

<p>
Variables &gt; User-Defined Variables &gt; New &gt; Type: Data Layer variable &gt; Configure variable &gt; Data Layer Variable Name: action
</p>

<img src="sc-images/260-action-var.png">

<h3>
<a id="create-youtubelabelvar-data-layer-variable" class="anchor" href="#create-youtubelabelvar-data-layer-variable" aria-hidden="true"><span class="octicon octicon-link"></span></a>Create YouTubeLabelVar Data layer Variable</h3>

<p>
As for the YouTubeActionVar you just created - but this time the Data Layer Variable Name is label.
</p>

<h3>
<a id="create-youtube-tag" class="anchor" href="#create-youtube-tag" aria-hidden="true"><span class="octicon octicon-link"></span></a>Create YouTubeTag</h3>

<p>
This is the glue that combines all the things we've set up in GTM so far and allows events coming in from our Javascript code to be passed on to GA.
</p>

<p>
Tags &gt; New &gt; Choose Product: Google Analytics &gt; Choose a Tag Type: Universal Analytics &gt; Configure Tag
</p>

<p>
Configure the tag as in the following image. Note we are making use here of all our variables. You can leave all the other items in the Configure block with their default values.
</p>

<p>
Once the Configure block is completed, click Continue.
</p>

<img src="sc-images/270-configure-youtube-tag.png">

<p>
We want these event values from our Javascript to be passed to GA when our YouTubeEventTrig is set off. 
</p>

<p>
Choose Fire On &gt; More and this window will pop up where you can select the YouTubeEventTrig you defined earlier.
</p>

<img src="sc-images/280-youtube-event-trig.png">

<h3>
<a id="remember-to-publish-your-changes" class="anchor" href="#remember-to-publish-your-changes" aria-hidden="true"><span class="octicon octicon-link"></span></a>REMEMBER TO PUBLISH YOUR CHANGES</h3>

<p>
GA should now be monitoring your YouTube events.
</p>

<h3>
<a id="authors-and-contributors" class="anchor" href="#authors-and-contributors" aria-hidden="true"><span class="octicon octicon-link"></span></a>Authors and Contributors</h3>

<p>Grant March (<a href="https://github.com/grantmarch" class="user-mention">@grantmarch</a>)</p>
<p>Adapted from code by Lunametrics (<a href="https://github.com/lunametrics/youtube-google-analytics" class="user-mention">@lunametrics</a>)</p>

      </section>

    </div>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
    
  </body>
</html>
